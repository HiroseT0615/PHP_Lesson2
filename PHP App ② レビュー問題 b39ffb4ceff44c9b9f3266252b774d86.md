# PHP App ② レビュー問題

# PHP App ② レビュー

## XSS(クロスサイトスクリプティング)

### XSSとはどんな攻撃か、また攻撃者にどんなメリットがあるか説明してください。
-XSSとは
Webサイトの脆弱性を利用し、記述言語であるHTMLに悪質なスクリプトを埋め込む攻撃です。
悪質なサイトへ遷移させたりすることによって、ユーザーの情報を抜き取ることができますが、XSSの範囲は
スクリプトを実行するところまでなので、ユーザーの情報を抜き取ること自体はxssではなく、あくまで悪質な
サイトへ遷移させ、ユーザー情報等を盗める状態にするところまでになります。

-攻撃者のメリット
ユーザーを悪質なサイトへ遷移させることによって、ユーザーが情報を入力・送信する際にその入力された情報やcookie情報等を盗むことができます。

### `htmlspecialchars()`を`e()`として定義しなおすメリットを説明してください。
悪意のあるコードの埋め込みを防ぐことができます。


### `htmlspecialchars()`を使うことでなぜXSSが防げるのか説明してください。
PHPのhtmlspecialchars関数を使用することでエスケープ処理をすることができるためになります。
エスケープ処理とは、コード内の特殊文字を別の文字列の置き換える処理になります。
別の文字列へ置き換えることにより、攻撃者が紛れ込ませた悪質なスクリプトがただの文字列として扱われることになり、スクリプト言語として実行されなくなるため、XSSが防げるようになります。

## CSRF(クロスサイトリクエストフォージェリ)

### CSRFとはどんな攻撃か、また攻撃者にどんなメリットがあるか説明してください。
-CSRFとは
攻撃者が罠として用意した偽造サイトを用いて、ユーザが意図していないリクエストを強制的に行わせる攻撃になります。
・意図しない商品購入
・意図しない退会処理
・意図しない投稿
など、自分以外の誰かに処理を行わせます。
具体的には既存サービス(Amazonや楽天等)と全く同じ見た目のサイトを作成し、多くの人が自分の作成したサイトへ来るようにし、マイページに遷移するボタンを押したとき、そのボタンのaction属性をマイページのURLではなく、掲示板の投稿URLに変えることにより多数の人へその人のアカウントで掲示板への投稿をしてしまうようになります。

-攻撃者のメリット
自分以外の不特定多数の誰かに攻撃をさせるので、攻撃者自体が見つかりにくくなる。

### SessionとCookieの違いを説明してください。
-SESSIONとは
データを一時的に保存するサーバ側の領域のことです。
サーバ側でデータを保存するので、ユーザー側では内容を書き換えることができません。
よって、個人情報やログイン情報等の信頼性があり、セキュリティ面で優れています。


-COOKIEとは
データを一時的に保存するブラウザ側の領域のことです。
ログイン状態の保持などに使用されますが、データがブラウザ側で保存されているため、cookieが第三者へと渡ってしまうと、その情報の持ち主になりすましが可能になり、個人情報やクレジットカード情報が流出してしまう恐れがあります。

### `setToken()`が何をしているか説明してください。
・openssl_random_pseudo_bytes(16)で、ランダムな 16 文字のバイト文字列を生成
・上記で生成した文字列を bin2hex で 16 進数に変換→指定した文字列を16進表現に変換したものを返します。
・生成された値を $_SESSION['token'] に格納

### `checkToken()`が何をしているか説明してください。
フォームから送信されたトークン(setToken関数にて生成し送信したトークン)が、実際にサーバーから送ったトークンと一致しているかどうかをチェックしています。

### トークンを使うことでなぜCSRFが防げるのか説明してください。
トークンはアクセスする度に内容が変わるため、一度フォームにアクセスしてソースコードの中に記載されているトークンを調べても、次のタイミングに別の画面からアクセスした時にはトークンがは変わってしまっているため、外部から意図しないPOSTができないようになっているので、CSRFの対策となっています。

## SQLインジェクション

### SQLインジェクションとはどんな攻撃か、また攻撃者にどんなメリットがあるか説明してください。
検索ボックスや入力フォームなどに記入する文字列に不正な操作を行うSQL文を意図的に「注入」することにより、データベース内のデータの消去や改ざんといった操作やデータの盗用を図る攻撃です。

### `->prepare()`の返り値と、またこのメソッドが何をしているか説明してください。
-返り値-
データベースサーバが正常に正常に文を準備する場合、PDOStatementオブジェクトを返します。
もしデータベースサーバが文を準備できなかった場合は FALSE を返します。

-メソッド-
データベースに送信しようとするSQL文の準備をしています。

### `->bindValue()`が何をしているか説明してください。
プリペアドステートメントで使用する SQL 文の中で、 対応する名前あるいは疑問符のプレースホルダに値をバインドします。

### 今回の対策でなぜSQLインジェクションが防げるのか説明してください。
一旦プレースホルダーでクッションを挟むことによってユーザーが入力したデータのデータ型を指定し、文字列として認識させ、SQL文を悪意のある攻撃から守ることができます。

## バリデーション

### バリデーションの目的について説明してください。
記入された内容が規定された文法に即して、または要求された仕様にそって、適切に記述されているかどうかを検証する目的になります。

### `validate()`が何をしているか説明してください。
入力された値が規則にそっていれば true を、規則にそっていなければ場合に false を返します。何も入力されていない場合は、このメソッドは false を返します。

### `isset($post['content'])`はなぜ必要か、無い場合どうなるか説明してください。
削除をする際に一度contentカラムの値をisset関数にてcontentの中に値が入っているか確認し、trueを返すことによって
正常に動くようにしています。
無い場合、削除を実行する工程でcontentカラムへデータの入力をしていないので、エラーになってしまいます。
## その他

### `unsetError()`を実行しないとどうなるか説明してください。
unsetError()を実行しないと、エラーが出た状態からそのエラーの解除するコードがなくなってしまうため、
その後のエラー文がずっと残り続けてしまいます。
